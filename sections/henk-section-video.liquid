{% comment %}
  henk-section-video.liquid
  - A full-width video section.
  - Uses the `henk-video` snippet for markup + JS behavior.
{% endcomment %}

{% assign video_url = '' %}
{% assign max_width = 0 %}

{% if section.settings.video_src.sources %}
  {% for source in section.settings.video_src.sources %}
    {% if source.format == 'mp4' and source.width > max_width %}
      {% assign max_width = source.width %}
      {% assign video_url = 'https:' | append: source.url %}
    {% endif %}
  {% endfor %}
{% endif %}

{% assign poster_url = '' %}
{% if section.settings.video_poster %}
  {% assign poster_url = section.settings.video_poster %}
  {% if poster_url contains '//cdn.shopify.com' %}
    {% assign poster_url = 'https:' | append: poster_url %}
  {% else %}
    {% assign poster_url = poster_url | asset_url %}
  {% endif %}
{% endif %}

<section
  class="
    henk-video-section
    {% if section.settings.cover %} henk-video-section--cover{% endif %}
    {% if section.settings.rounded %} henk-video-section--rounded{% endif %}
  "
>
  {% render 'henk-video',
    id: section.id,
    src: video_url,
    poster: poster_url,
    autoplay: section.settings.autoplay,
    loop: section.settings.loop,
    cover: section.settings.cover,
    rounded: section.settings.rounded,
    description: section.settings.description
  %}
</section>

{% schema %}
{
  "name": "Video Section",
  "settings": [
    {
      "type": "video",
      "id": "video_src",
      "label": "Video URL"
    },
    {
      "type": "image_picker",
      "id": "video_poster",
      "label": "Poster image"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay video",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": "Loop video",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "cover",
      "label": "Cover container (object-fit: cover)",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "rounded",
      "label": "Rounded corners",
      "default": false
    },
    {
      "type": "text",
      "id": "description",
      "label": "Accessibility description (for screen readers)",
      "default": "Background video"
    }
  ],
  "presets": [
    {
      "name": "Video Section",
      "category": "Media"
    }
  ]
}
{% endschema %}
