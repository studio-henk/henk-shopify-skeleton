{% comment %}
  This section is used in the product template to render product page with
  media, content, and add-to-cart form.

  https://shopify.dev/docs/storefronts/themes/architecture/templates/product
{% endcomment %}

<style>
  .product-images {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
  }

  .product-image {
    margin: 0;
  }

  .henk-input[name='quantity'] {
    display: none;
  }

  .product__title {
    margin-top: 0;
  }

  .options__container {
    display: flex;
    gap: 1rem;

    .henk-label {
      position: relative;
    }
  }

  .henk-radio {
  }

  .henk-labeled-input {
    margin-bottom: 0;
  }

  .options__container .henk-radio {
    position: absolute;
    opacity: 0;
  }

  .custom-swatch {
    display: block;
    width: 44px;
    height: 44px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  input[type='radio']:checked + .custom-swatch {
    border: 2px solid #000;
  }
</style>

<section class="henk-section">
  <div class="henk-section__inner">
    {% comment %} {{ product | json }} {% endcomment %}
    {% comment %} {{ product | json }} {% endcomment %}

    <div class="henk-section__grid">
      <div class="henk-section__grid-item">
        <div class="product-images">
          {% for image in product.images %}
            {% comment %} {% render 'image', class: 'product-image', image: image %} {% endcomment %}
            {%- assign img_width = 1200 -%}
            {%- assign img_height = 1200 -%}

            <img
              src="{{ image | image_url: width: img_width }}"
              alt="{{ image.alt | escape | default: product.title }}"
              width="{{ img_width }}"
              height="{{ img_height }}"
              class="product-image"
              loading="lazy"
              {% if image.id %}
                data-image-id="{{ image.id }}"
              {% endif %}
            >
          {% endfor %}
        </div>
      </div>

      <div class="henk-section__grid-item">
        <div class="product-info">
          <h1 class="product__title">{{ product.title }}</h1>
          <p class="product__price">{{ product.price | money }}</p>
          <p class="product__description">{{ product.description }}</p>
        </div>

        <div class="product-form">
          {% form 'product', product %}
            {% assign current_variant = product.selected_or_first_available_variant %}

            <fieldset class="henk-fieldset">
              <legend class="henk-legend">Colour</legend>
              <div class="options__container">
                {% for variant in product.variants %}
                  {% assign color_obj = variant.metafields.HENK.colour.value | first %}
                  <div class="henk-labeled-input henk-labeled-input--dir-verticalx">
                    <label class="henk-label">
                      <input
                        class="henk-radio"
                        type="radio"
                        name="id"
                        value="{{ variant.id }}"
                        {% if variant.id == current_variant.id %}
                          checked
                        {% endif %}
                        {% unless variant.available %}
                          disabled
                        {% endunless %}
                      >
                      <span
                        class="custom-swatch"
                        style="
                          background-color:
                          {{color_obj.colour}}
                        "
                      ></span>
                      <span class="visually-hidden">{{ color_obj.name | default: variant.option1 }}</span>
                    </label>
                  </div>
                {% endfor %}
              </div>
            </fieldset>

            {%- comment -%}test radio buttons for options {%- endcomment -%}
            {% comment %} {% for option in product.options_with_values %} {% endcomment %}
            {% comment %}   <fieldset class=""> {% endcomment %}
            {% comment %}     <legend>{{ option.name }}</legend> {% endcomment %}
            {% comment %}{% endcomment %}
            {% comment %}     {% for value in option.values %} {% endcomment %}
            {% comment %}       {% assign variant_for_value = product.variants | where: option.name, value | first %} {% endcomment %}
            {% comment %}       <label> {% endcomment %}
            {% comment %}         <input {% endcomment %}
            {% comment %}           type="radio" {% endcomment %}
            {% comment %}           name="id" {% endcomment %}
            {% comment %}           value="{{ variant_for_value.id }}" {% endcomment %}
            {% comment %}           {% if variant_for_value.id == current_variant.id %} {% endcomment %}
            {% comment %}             checked="checked" {% endcomment %}
            {% comment %}           {% endif %} {% endcomment %}
            {% comment %}           {% unless variant_for_value.available %} {% endcomment %}
            {% comment %}             disabled {% endcomment %}
            {% comment %}           {% endunless %} {% endcomment %}
            {% comment %}         > {% endcomment %}
            {% comment %}         {{ value }} {% endcomment %}
            {% comment %}       </label> {% endcomment %}
            {% comment %}     {% endfor %} {% endcomment %}
            {% comment %}   </fieldset> {% endcomment %}
            {% comment %} {% endfor %} {% endcomment %}

            <input type="text" name="quantity" min="1" value="1" class="henk-input">

            {%- comment -%}check if has sku. if not, dont show buttons{%- endcomment -%}
            {% if current_variant.sku == blank %}
              {% render 'henk-info-box',
                variant: 'danger',
                title: 'NO SKU ASSIGNED',
                content: '<p>This product cannot be added to the cart yet. Please contact us.</p>',
                icon_name: 'danger'
              %}
            {% else %}
              <div class="henk-button-group">
                <input type="submit" value="Add to cart" class="henk-button">
                {{ form | payment_button }}
              </div>
            {% endif %}
          {% endform %}
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "t:general.product",
  "settings": [],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
