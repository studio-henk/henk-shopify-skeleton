{% comment %}
  henk-section-video.liquid
  - A full-width video section.
  - Uses the `henk-video` snippet for markup + JS behavior.
{% endcomment %}
{{ section.settings.video_poster }}
{% assign video_url = '' %}
{% assign max_width = 0 %}

{% if section.settings.video_src.sources %}
  {% for source in section.settings.video_src.sources %}
    {% if source.format == 'mp4' and source.width > max_width %}
      {% assign max_width = source.width %}
      {% assign video_url = 'https:' | append: source.url %}
    {% endif %}
  {% endfor %}
{% endif %}

{% comment %} {% assign poster_url = '' %} {% endcomment %}
{% comment %} {% if section.settings.video_poster %} {% endcomment %}
{% comment %}   {% assign poster_url = section.settings.video_poster %} {% endcomment %}
{% comment %}{% endcomment %}
{% comment %}   {% if poster_url contains '//cdn.shopify.com' %} {% endcomment %}
{% comment %}     oi {% endcomment %}
{% comment %}     {% unless poster_url contains 'https:' %} {% endcomment %}
{% comment %}       whtf {% endcomment %}
{% comment %}       {% assign poster_url = 'https:' | append: poster_url %} {% endcomment %}
{% comment %}     {% endunless %} {% endcomment %}
{% comment %}   {% else %} {% endcomment %}
{% comment %}     ????? {% endcomment %}
{% comment %}     {% assign poster_url = poster_url %} {% endcomment %}
{% comment %}   {% endif %} {% endcomment %}
{% comment %} {% endif %} {% endcomment %}

{% assign poster_url = section.settings.video_poster | file_url %}

<section
  class="henk-video-section"
>
  {% render 'henk-video',
    id: section.id,
    src: video_url,
    poster: poster_url,
    autoplay: section.settings.autoplay,
    loop: section.settings.loop,
    cover: section.settings.cover,
    rounded: section.settings.rounded,
    description: section.settings.description
  %}
</section>

{% schema %}
{
  "name": "Video Section",
  "settings": [
    {
      "type": "video",
      "id": "video_src",
      "label": "Video URL"
    },
    {
      "type": "image_picker",
      "id": "video_poster",
      "label": "Poster image"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay video",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": "Loop video",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "cover",
      "label": "Cover container (object-fit: cover)",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "rounded",
      "label": "Rounded corners",
      "default": false
    },
    {
      "type": "text",
      "id": "description",
      "label": "Accessibility description (for screen readers)",
      "default": "Background video"
    }
  ],
  "presets": [
    {
      "name": "Video Section",
      "category": "Media"
    }
  ]
}
{% endschema %}
