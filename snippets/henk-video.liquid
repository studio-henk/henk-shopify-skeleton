{%- comment -%}
  henk-video.liquid
  Props:
    id: string (optional)
    src: string (required)
    poster: string (optional)
    autoplay: boolean (default: false)
    loop: boolean (default: true)
    cover: boolean (default: false)
    rounded: boolean (default: false)
    description: string (optional)
    link: imageLink,
    link_target_blank: imageLinkTargetBlank
{%- endcomment -%}

{% comment %} {%- assign video_id = id | default: section.id | append: '-video' -%} {% endcomment %}

{%- assign video_id = id | default: 'split-screen-video-' | append: media_obj.id | append: '-video' -%}

{% comment %} {{ src | json }} {% endcomment %}
<div
  id="{{ video_id }}"
  class="
    henk-video-container
    {% if cover %} henk-video-container--cover{% endif %}
    {% if rounded %} henk-video-container--rounded{% endif %}
  "
>
  {% if src.sources %}
    {% if link %}
      <a
        href="{{ link }}"
        {% if link_target_blank %}
          target="_blank" rel="noopener"
        {% endif %}
      >
        <video
          class="henk-video"
          {% if poster %}
            poster="{{ poster }}"
          {% endif %}
          {% if autoplay %}
            autoplay muted playsinline
          {% else %}
            controls
          {% endif %}
          {% if loop %}
            loop
          {% endif %}
          preload="auto"
          aria-label="{{ description | escape }}"
        >
          {% for source in src.sources %}
            <source src="{{ 'https:' | append: source.url }}" type="{{ source.mime_type }}">
          {% endfor %}
        </video>
      </a>
    {% else %}
      <video
        class="henk-video"
        {% if poster %}
          poster="{{ poster }}"
        {% endif %}
        {% if autoplay %}
          autoplay muted playsinline
        {% else %}
          controls
        {% endif %}
        {% if loop %}
          loop
        {% endif %}
        preload="auto"
        aria-label="{{ description | escape }}"
      >
        {% for source in src.sources %}
          <source src="{{ 'https:' | append: source.url }}" type="{{ source.mime_type }}">
        {% endfor %}
      </video>
    {% endif %}
  {% else %}
    {% if link %}
      <a
        href="{{ link }}"
        {% if link_target_blank %}
          target="_blank" rel="noopener"
        {% endif %}
      >
        <video
          class="henk-video"
          src="{{ src }}"
          {% if poster %}
            poster="{{ poster }}"
          {% endif %}
          {% if autoplay %}
            autoplay muted playsinline
          {% else %}
            controls
          {% endif %}
          {% if loop %}
            loop
          {% endif %}
          preload="auto"
          aria-label="{{ description | escape }}"
        ></video>
      </a>
    {% else %}
      <video
        class="henk-video"
        src="{{ src }}"
        {% if poster %}
          poster="{{ poster }}"
        {% endif %}
        {% if autoplay %}
          autoplay muted playsinline
        {% else %}
          controls
        {% endif %}
        {% if loop %}
          loop
        {% endif %}
        preload="auto"
        aria-label="{{ description | escape }}"
      ></video>
    {% endif %}
  {% endif %}
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const container = document.getElementById('{{ id | escape }}-video');
    if (!container) return;

    const video = container.querySelector('video');
    if (!video) return;

    video.addEventListener('loadedmetadata', () => {
      const hasAudio =
        video.mozHasAudio ||
        video.webkitAudioDecodedByteCount > 0 ||
        (video.audioTracks && video.audioTracks.length > 0);

      if (!hasAudio) return; // no button if silent

      // Create button dynamically
      const buttonHTML = `...template literal from earlier...`;
      const temp = document.createElement('div');
      temp.innerHTML = buttonHTML.trim();
      const button = temp.firstChild;
      container.appendChild(button);

      const svgMuted = button.querySelector('.volume-x');
      const svgPlaying = button.querySelector('.volume-2');

      // Initial state
      svgMuted.style.display = video.muted ? 'block' : 'none';
      svgPlaying.style.display = video.muted ? 'none' : 'block';

      button.addEventListener('click', () => {
        video.muted = !video.muted;
        svgMuted.style.display = video.muted ? 'block' : 'none';
        svgPlaying.style.display = video.muted ? 'none' : 'block';
      });
    });

    // Optional: IntersectionObserver for autoplay/pause here
  });
</script>
