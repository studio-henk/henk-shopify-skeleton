{% comment %}
  This section is used in the product template to render product page with
  media, content, and add-to-cart form.

  https://shopify.dev/docs/storefronts/themes/architecture/templates/product
{% endcomment %}

{% comment %} {{ product | json }} {% endcomment %}

{% assign current_variant = product.selected_or_first_available_variant %}
{% comment %} {{ current_variant | json }} {% endcomment %}
{% comment %} {{ product.featured_image | json }} {% endcomment %}
{% comment %} {{ product | json }} {% endcomment %}

<section class="henk-section">
  <div class="henk-section__inner">
    <div class="henk-section__grid">
      <div class="henk-section__grid-item">
        <figure class="henk-figure">
          {% assign display_image = current_variant.featured_image | default: product.featured_image %}

          {% comment %} {% if current_variant.featured_image %} {% endcomment %}
          {% if display_image %}
            <img
              id="ProductFeaturedImage"
              class="henk-figure__img"
              src="{{ display_image | image_url: width: 1134 }}"
              alt="{{ product.title }}"
              width="1134"
              height="1134"
            >
          {% else %}
            {{ 'image' | placeholder_svg_tag }}
          {% endif %}
        </figure>

        <h3>gallery</h3>
        <div class="product-images">
          {% for image in product.images %}
            {%- assign img_width = 1200 -%}
            {%- assign img_height = 1200 -%}

            <img
              src="{{ image | image_url: width: img_width }}"
              alt="{{ image.alt | escape | default: product.title }}"
              width="{{ img_width }}"
              height="{{ img_height }}"
              class="product-image"
              loading="lazy"
              {% if image.id %}
                data-image-id="{{ image.id }}"
              {% endif %}
            >
          {% endfor %}
        </div>
      </div>

      <div class="henk-section__grid-item">
        <div class="product-info">
          {% assign display_title = current_variant.name | default: product.title %}
          <h1 class="product__title">{{ display_title }}</h1>

          {%- comment -%}
            if uses metafield get it from it if not then get from
            Color metaobject
          {%- endcomment -%}
          {%- if current_variant.metafields.HENK.size > 0 -%}
            {% comment %}loop through metafields to get material name{% endcomment %}
            {% for key in current_variant.metafields.HENK %}
              {% assign current_material = key[1].value.name %}
            {% endfor %}
          {% else %}
            {% assign current_material = current_variant.option1 %}
          {%- endif -%}
          <p id="SelectedMaterial">{{ current_material }}</p>

          <p id="ProductPrice" class="product__price">
            {% render 'henk-snippet-money', amount: current_variant.price %}
          </p>

          <p class="product__description">{{ product.description }}</p>
        </div>
        <div class="product-form">
          {% form 'product', product %}
            {% assign number_of_product_options = product.options_with_values.size %}
            {% assign number_of_product_variants = product.variants.size %}

            {% if number_of_product_options == 0 %}
              options: {{ number_of_product_options }}
            {% elsif number_of_product_options == 1 %}
              {% if number_of_product_variants == 1 %}
                {%- comment -%} NOTE: single variant, no options {%- endcomment -%}
                <input type="hidden" name="id" value="{{ current_variant.id }}">
              {% else %}
                {% comment %} NOTE: multiple variants, show options {% endcomment %}
                {%- comment -%}
                  ie lean lunounge chair, 1 option: fabric,
                  multiple choices
                {%- endcomment -%}

                {% render 'henk-snippet-product-options', product: product, current_variant: current_variant %}
              {% endif %}

            {% elsif number_of_product_options > 1 %}
              {% render 'henk-snippet-product-options-multi', product: product, current_variant: current_variant %}
            {% endif %}

            <input type="text" name="quantity" min="1" value="1" class="henk-input">

            {%- comment -%}check if has sku. if not, dont show buttons{%- endcomment -%}
            {% if current_variant.sku == blank %}
              {% render 'henk-info-box',
                variant: 'danger',
                title: 'NO SKU ASSIGNED',
                content: '<p>This product cannot be added to the cart yet. Please contact us.</p>',
                icon_name: 'danger'
              %}
            {% else %}
              <div class="henk-button-group henk-button-group--left">
                <a href="" class="henk-button henk-button--ghost">Bekijk in winkel</a>
                <input
                  type="submit"
                  value="Add to cart"
                  class="
                    henk-button
                    henk-button--primary
                  "
                >

                {% render 'henk-button',
                  element: 'button',
                  label: 'Add to cart',
                  variant: 'tertiary',
                  icon_name: 'feather-shopping-bag'
                %}
                <button>icon: {% render 'henk-icon-test', name: 'feather-shopping-bag' %}</button>
                <!-- {{ form | payment_button }} -->
              </div>
            {% endif %}
          {% endform %}
        </div>
      </div>
    </div>
  </div>
</section>

<hr>
<section class="henk-section">
  <div class="henk-section__inner">
    <div class="henk-section__grid">
      <div class="henk-section__grid-item">
        <h2>Product details</h2>
        <p>{{ product.description }}</p>
      </div>

      <div class="henk-section__grid-item">
        <h2>Specifications</h2>
        <small id="ProductSKU">SKU: {{ current_variant.sku }}</small>
        <ul>
          {% for spec in product.metafields.specs.specifications %}
            <li>{{ spec }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</section>

<style>
  .product-images {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
  }

  .product-image {
    margin: 0;
  }

  .henk-input[name='quantity'] {
    display: none;
  }

  .product__title {
    margin-top: 0;
  }

  .options__container {
    display: flex;
    gap: 1rem;

    .henk-label {
      position: relative;

      &.disabled {
        cursor: not-allowed;
        /* opacity: 0.5; */
        display: none;
      }
    }
  }

  .henk-radio {
    margin: 0;
  }

  .henk-labeled-input {
    margin-bottom: 0;
  }

  .options__container .henk-radio {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    width: 44px;
    height: 44px;
  }

  .custom-swatch {
    display: block;
    width: 44px;
    height: 44px;
    border-radius: 4px;
    border: 1px solid #ccc;
    overflow: clip;

    .swatch__image {
      shape-margin: 0;
      margin-bottom: 0;
    }
  }

  input[type='radio']:checked + .custom-swatch {
    border: 4px solid var(--color-blue-40);
  }
</style>
{% schema %}
{
  "name": "t:general.product",
  "settings": [],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
