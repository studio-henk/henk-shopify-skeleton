{% comment %}
  Snippet: henk-split-screen
  Props:
    bg_color, id, title, caption, level, display, content,
    media, media_type, poster, has_audio, rounded,
    image_alt, image_link, image_link_target_blank,
    button_url, button_text, button_variant, reverse
{% endcomment %}

{%- comment -%}
  Normalize props for snippet:
  - If `props` is passed (from a section), use it
  - Otherwise, fall back to individually passed variables
{%- endcomment -%}

{% assign p = props | default: null %}

{% assign section_title = p.title | default: title %}
{% assign section_caption = p.caption | default: caption %}
{% assign section_heading_level = p.level | default: 2 %}
{% assign section_content = p.content | default: content %}
{% assign section_media_type = p.media_type | default: media_type %}
{% assign section_media = p.media | default: media %}
{% assign section_poster = p.poster | default: poster %}
{% assign section_has_audio = p.has_audio | default: has_audio %}
{% assign section_rounded = p.rounded | default: rounded %}
{% assign section_image_alt = p.image_alt | default: image_alt %}
{% assign section_image_link = p.image_link | default: imageLink %}
{% assign section_image_link_target_blank = p.image_link_target_blank | default: imageLinkTargetBlank %}
{% assign section_button_url = p.button_url | default: buttonUrl %}
{% assign section_button_text = p.button_text | default: buttonText %}
{% assign section_button_variant = p.button_variant | default: buttonVariant %}
{% assign section_reverse = p.reverse | default: reverse %}
{% assign section_bg_color = p.bg_color | default: bgColor %}
{% assign section_id = p.id | default: id %}

{%- comment -%}
  Normalize media object
  - Handles section VideoDrop, metaobject VideoDrop, or image
{%- endcomment -%}

{% assign media_obj = null %}
{% assign media_type = section_media_type %}

{% if section_media %}
  {% if section_media.src %}
    {% assign media_obj = section_media.src %}
    {% if section_media.content_type contains 'video' %}
      {% assign media_type = 'video' %}
    {% else %}
      {% assign media_type = 'image' %}
    {% endif %}
  {% elsif section_media.value and section_media.value.src %}
    {% assign media_obj = section_media.value.src %}
    {% assign media_type = 'image' %}
  {% elsif section_media.value %}
    {% assign media_obj = section_media.value %}
    {% assign media_type = 'image' %}
  {% endif %}
{% endif %}

{{ section_media_type }}
{{ media_obj }}

<div
  class="henk-section henk-split-screen{% if section_bg_color and section_bg_color != 'default' %} henk-split-screen--bg-{{ section_bg_color }}{% endif %}"
  {% if section_id %}
    id="{{ section_id }}"
  {% endif %}
>
  <div
    class="henk-split-screen__inner"
    {% if section_reverse %}
      data-order="reverse"
    {% endif %}
  >
    <div class="henk-split-screen__grid">
      <!-- MEDIA COLUMN -->
      <div class="henk-split-screen__grid-item">
        {% if media_obj %}
          {% case section_media_type %}
            {% when 'image' %}
              {% if section_image_link %}
                <a
                  href="{{ section_image_link }}"
                  {% if section_image_link_target_blank %}
                    target="_blank" rel="noopener"
                  {% endif %}
                >
              {% endif %}
              <img
                src="{{ media_obj | image_url: width: 1152, height: 1728 }}"
                alt="{{ section_image_alt | escape }}"
                class="henk-split-screen__img"
                loading="lazy"
                width="1152"
                height="1728"
              >
              {% if section_image_link %}
                </a>
              {% endif %}
            {% when 'video' %}
              {% render 'henk-video',
                id: section_id,
                src: media_obj,
                poster: section_poster,
                autoplay: true,
                has_audio: section_has_audio,
                loop: true,
                cover: true,
                rounded: section_rounded,
                description: section_image_alt,
                link: section_image_link,
                link_target_blank: section_image_link_target_blank
              %}
          {% endcase %}
        {% endif %}
      </div>

      <!-- CONTENT COLUMN -->
      <div class="henk-split-screen__grid-item">
        <div class="henk-split-screen__content">
          {% if section_caption %}
            <p class="henk-split-screen__caption">{{ section_caption }}</p>
          {% endif %}

          {% assign heading_tag = 'h' | append: section_heading_level %}
          {% if section_title %}
            <{{ heading_tag }} class="henk-split-screen__title">
              {{ section_title }}
            </{{ heading_tag }}>
          {% endif %}

          {% if section_content %}
            <div class="henk-split-screen__text">
              {% if section_content.children %}
                {% render 'henk-rich-text', children: section_content.children %}
              {% else %}
                {{ section_content }}
              {% endif %}
            </div>
          {% endif %}

          {% if section_button_url and section_button_text %}
            <a
              href="{{ section_button_url | prepend: routes.root }}"
              class="henk-button henk-button--{{ section_button_variant | default: 'default' }}"
            >
              {{ section_button_text }}
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
