{% comment %} {{ collection | json }} {% endcomment %}
{% comment %} {{ product | json }} {% endcomment %}
{% comment %} {{ product.tags | json }} {% endcomment %}

{% assign card_url = product.url %}
{% if variant %}
  {% assign card_url = product.url | append: '?variant=' | append: variant.id %}
{% endif %}

<div class="henk-card {% if card_variant %} henk-card--{{ card_variant }}{% endif %}">
  <a
    href="{{ card_url }}"
    class="henk-card__image-link"
  >
    <figure class="henk-card__image-container">
      {% assign img = variant.featured_image | default: product.featured_image %}
      {% if img %}
        <img
          class="henk-card__img"
          src="{{ img | image_url: width: 1134 }}"
          alt="{{ img.alt | default: product.title }}"
          width="1134"
          height="1134"
        >
      {% else %}
        {{ 'image' | placeholder_svg_tag }}
      {% endif %}
    </figure>
  </a>
  {% if show_variants_on_card %}
    <div class="henk-card__variant-selector">
      {{ products.variants | json }}
    </div>
  {% endif %}
  <div class="henk-card__content">
    <p class="henk-card__title truncate">{{ product.title }}</p>

    {% if variant %}
      <p class="henk-card__subtitle">{{ variant.title }}</p>
    {% else %}
      <p class="henk-card__subtitle">???</p>
    {% endif %}

    {% if card_variant == null %}
      {% if product.metafields.custom.short_description != blank %}
        <p
          class="henk-card__description truncate"
          title="{{ product.metafields.custom.short_description }}"
        >
          {{ product.metafields.custom.short_description }}
        </p>
      {% endif %}
    {% else %}
      <p class="henk-card__price">
        {% if product.price_varies %}
          {{ 'card.from_label' | t }}
          {{ product.price_min | money_without_trailing_zeros }}
        {% else %}
          {{ product.price | money_without_trailing_zeros }}
        {% endif %}
      </p>
    {% endif %}

    {% if card_variant == null %}
      {% assign min_price = product.price_min | money_without_trailing_zeros %}

      {% if product.price_varies %}
        {% assign price_label = 'card.from_label' | t | append: ' ' | append: min_price %}
      {% else %}
        {% assign price_label = product.price | money_without_trailing_zeros %}
      {% endif %}

      {% render 'henk-button', element: 'a', href: card_url, label: price_label, extra_classes: 'henk-card__button' %}
    {% endif %}
  </div>
  {% if product.tags != blank %}
    <div class="henk-card__tags">
      {% for tag in product.tags limit: 1 %}
        {% render 'henk-tag', tag: tag %}
      {% endfor %}
    </div>
  {% endif %}
</div>
