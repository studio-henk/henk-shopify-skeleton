{% comment %}
  Snippet: henk-split-screen
  Props:
    bgColor, id, title, caption, level, display, content,
    media, media_type, poster, hasAudio, rounded,
    imageAlt, imageLink, imageLinkTargetBlank,
    buttonUrl, buttonText, buttonVariant, reverse
{% endcomment %}

{% assign p = props | default: section.settings %}
{% comment %} {% assign p = props | default: {} %} {% endcomment %}

{% comment %} {{ p | json }} {% endcomment %}
{% comment %} {{ id }} {% endcomment %}

{%- comment -%}
  Normalize props for snippet:
  - If `props` is passed (from a section), use it
  - Otherwise, use individual variables passed to snippet (from metaobject)
{%- endcomment -%}

{% comment %} {% if props %} {% endcomment %}
{% comment %}   {% assign p = props %} {% endcomment %}
{% comment %} {% else %} {% endcomment %}
{% comment %}   {% assign p = {} %} {% endcomment %}
{% comment %}   {% assign p = p | merge: { "id": id } %} {% endcomment %}
{% comment %}   {% assign p = p | merge: { "title": title } %} {% endcomment %}
{% comment %} {% endif %} {% endcomment %}

{{ p | json }}

{{ id | json }}

{%- comment -%}
  Normalize media object (handles either `media.value` or direct media)
{%- endcomment -%}

{% if p.media_type == 'video' and p.video_src != blank %}
  {% assign media_obj = p.video_src %}
{% elsif p.media_type == 'image' and p.image_src != blank %}
  {% assign media_obj = p.image_src %}
{% else %}
  {% assign media_obj = null %}
{% endif %}

<div
  class="henk-section henk-split-screen{% if p.bgColor and p.bgColor != 'default' %} henk-split-screen--bg-{{ p.bgColor }}{% endif %}"
  {% if p.id %}
    id="{{ p.id }}"
  {% endif %}
>
  <div
    class="henk-split-screen__inner"
    {% if p.reverse %}
      data-order="reverse"
    {% endif %}
  >
    <div class="henk-split-screen__grid">
      <!-- MEDIA COLUMN -->
      <div class="henk-split-screen__grid-item">
        {% if media_obj %}
          {% case p.media_type %}
            {% when 'image' %}
              {% if p.imageLink %}
                <a
                  href="{{ p.imageLink }}"
                  {% if p.imageLinkTargetBlank %}
                    target="_blank" rel="noopener"
                  {% endif %}
                >
              {% endif %}
              <img
                src="{{ media_obj | image_url: width: 1152, height: 1728 }}"
                alt="{{ p.imageAlt | escape }}"
                class="henk-split-screen__img"
                loading="lazy"
                width="1152"
                height="1728"
              >
              {% if p.imageLink %}
                </a>
              {% endif %}
            {% when 'video' %}
              {% render 'henk-video',
                id: p.id,
                src: media_obj,
                poster: p.poster,
                autoplay: true,
                has_audio: p.video_has_audio,
                loop: true,
                cover: true,
                rounded: p.rounded_corners,
                description: p.imageAlt,
                link: p.imageLink,
                link_target_blank: p.imageLinkTargetBlank
              %}
          {% endcase %}
        {% endif %}
      </div>

      <!-- CONTENT COLUMN -->
      <div class="henk-split-screen__grid-item">
        <div class="henk-split-screen__content">
          {% if p.caption %}
            <p class="henk-split-screen__caption">{{ p.caption }}</p>
          {% endif %}

          {% comment %} {% assign heading_level = p.level | default: 2 %} {% endcomment %}
          {% comment %} {% if heading_level > 3 %}{% assign heading_level = 3 %}{% endif %} {% endcomment %}
          {% comment %} {% if heading_level < 1 %}{% assign heading_level = 1 %}{% endif %} {% endcomment %}
          {% comment %}{% endcomment %}
          {% comment %} {% if p.title %} {% endcomment %}
          {% comment %}   <h{{ heading_level }} class="henk-split-screen__title{% if p.display %} fs-display{% endif %}"> {% endcomment %}
          {% comment %}     {{ p.title }} {% endcomment %}
          {% comment %}   </h{{ heading_level }}> {% endcomment %}
          {% comment %} {% endif %} {% endcomment %}

          {% assign heading_tag = 'h' | append: p.heading_level | default: 'h2' %}

          {% if p.title | default: title %}
            <{{ heading_tag }} class="henk-split-screen__title">
              {{ p.title | default: title }}
            </{{ heading_tag }}>
          {% endif %}

          {% if p.content %}
            <div class="henk-split-screen__text">
              {% if p.content.children %}
                {% render 'henk-rich-text', children: p.content.children %}
              {% else %}
                {{ p.content }}
              {% endif %}
            </div>
          {% endif %}

          {% if p.buttonUrl and p.buttonText %}
            <a
              href="{{ p.buttonUrl | prepend: routes.root }}"
              class="henk-button henk-button--{{ p.buttonVariant | default: 'default' }}"
            >
              {{ p.buttonText }}
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
