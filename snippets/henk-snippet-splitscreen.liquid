{% comment %}
  Snippet: henk-split-screen
  Props/variables supported:
    bgColor, id, title, caption, level, content,
    media_type, media, poster, video_has_audio, rounded,
    imageAlt, imageLink, imageLinkTargetBlank,
    buttonUrl, buttonText, buttonVariant, reverse
{% endcomment %}

{%- comment -%}
  Normalize all variables at the top:
  - Use `props.*` if available (from section)
  - Otherwise fallback to individual variables (metaobject)
{%- endcomment -%}

{% assign ss_id = props.id | default: id %}
{% assign ss_title = props.title | default: title %}
{% assign ss_caption = props.caption | default: caption %}
{% assign ss_level = props.level | default: level | default: 2 %}
{% assign ss_content = props.content | default: content %}
{% assign ss_media_type = props.media_type | default: media_type %}
{% assign ss_media = props.media | default: media %}
{% assign ss_imageAlt = props.imageAlt | default: imageAlt %}
{% assign ss_imageLink = props.imageLink | default: imageLink %}
{% assign ss_imageLinkTargetBlank = props.imageLinkTargetBlank | default: imageLinkTargetBlank %}
{% assign ss_buttonUrl = props.buttonUrl | default: buttonUrl %}
{% assign ss_buttonText = props.buttonText | default: buttonText %}
{% assign ss_buttonVariant = props.buttonVariant | default: buttonVariant | default: 'default' %}
{% assign ss_reverse = props.reverse | default: reverse | default: false %}
{% assign ss_bgColor = props.bgColor | default: bgColor | default: 'default' %}
{% assign ss_rounded = props.rounded | default: rounded | default: false %}
{% assign ss_poster = props.poster | default: poster %}
{% assign ss_video_has_audio = props.video_has_audio | default: false %}

{%- comment -%}
  Determine actual media object
{%- endcomment -%}
{% if ss_media_type == 'video' and ss_media != blank %}
  {% assign media_obj = ss_media %}
{% elsif ss_media_type == 'image' and ss_media != blank %}
  {% assign media_obj = ss_media %}
{% else %}
  {% assign media_obj = null %}
{% endif %}

<div
  id="{{ ss_id }}"
  class="henk-section henk-split-screen{% if ss_bgColor != 'default' %} henk-split-screen--bg-{{ ss_bgColor }}{% endif %}"
>
  <div
    class="henk-split-screen__inner"
    {% if ss_reverse %}
      data-order="reverse"
    {% endif %}
  >
    <div class="henk-split-screen__grid">
      <!-- MEDIA COLUMN -->
      <div class="henk-split-screen__grid-item">
        {% if media_obj %}
          {% case ss_media_type %}
            {% when 'image' %}
              {% if ss_imageLink %}
                <a
                  href="{{ ss_imageLink }}"
                  {% if ss_imageLinkTargetBlank %}
                    target="_blank" rel="noopener"
                  {% endif %}
                >
              {% endif %}
              <img
                src="{{ media_obj | image_url: width:1152, height:1728 }}"
                alt="{{ ss_imageAlt | escape }}"
                class="henk-split-screen__img"
                loading="lazy"
                width="1152"
                height="1728"
              >
              {% if ss_imageLink %}
                </a>
              {% endif %}
            {% when 'video' %}
              {% render 'henk-video',
                id: ss_id,
                src: media_obj,
                poster: ss_poster,
                autoplay: true,
                has_audio: ss_video_has_audio,
                loop: true,
                cover: true,
                rounded: ss_rounded,
                description: ss_imageAlt,
                link: ss_imageLink,
                link_target_blank: ss_imageLinkTargetBlank
              %}
          {% endcase %}
        {% endif %}
      </div>

      <!-- CONTENT COLUMN -->
      <div class="henk-split-screen__grid-item">
        <div class="henk-split-screen__content">
          {% if ss_caption %}
            <p class="henk-split-screen__caption">{{ ss_caption }}</p>
          {% endif %}

          {% assign heading_level = ss_level %}
          {% if heading_level < 1 %}{% assign heading_level = 1 %}{% endif %}
          {% if heading_level > 3 %}{% assign heading_level = 3 %}{% endif %}
          {% if ss_title %}
            <h{{ heading_level }} class="henk-split-screen__title">
              {{ ss_title }}
            </h{{ heading_level }}>
          {% endif %}

          {% if ss_content %}
            <div class="henk-split-screen__text">
              {% if ss_content.children %}
                {% render 'henk-rich-text', children: ss_content.children %}
              {% else %}
                {{ ss_content }}
              {% endif %}
            </div>
          {% endif %}

          {% if ss_buttonUrl and ss_buttonText %}
            <a
              href="{{ ss_buttonUrl | prepend: routes.root }}"
              class="henk-button henk-button--{{ ss_buttonVariant }}"
            >
              {{ ss_buttonText }}
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
